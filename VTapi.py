#not provided
import sys, os
from fakerequest import request_with_fake_headers
from bs4 import BeautifulSoup
import re


vtUrl = "https://www.virustotal.com/gui/file/%s/relations"
targetDesc = "Contacted IP Addresses from the file being studied."

'''
def GetMalwareCNCServFromVTapi(malHash):
    global vtAPIKey
    vt_api_files = VirusTotalAPIFiles(vtAPIKey)
    try:
        result = vt_api_files.get_relationship(malHash, 'behavious')
    except VirusTotalAPIError as err:
        print(err, err.err_code)
    else:
        if vt_api_files.get_last_http_error() == vt_api_files.HTTP_OK:
            result = json.loads(result)
            result = json.dumps(result, sort_keys=False, indent=4)
            print(result)
        else:
            print("HTTP Error: " + str(vt_api_files.get_last_http_error()))
'''

def GetMalwareCNCServFromVTapi(malHash):
    global vtAPIKey, vtUrl

    vtRequestUrl = vtUrl % malHash
    HTMLtext = request_with_fake_headers(vtRequestUrl)
    print(HTMLtext)
    soup = BeautifulSoup(HTMLtext, 'html.parser')

    print(soup.find_all('vt-ui-expandable'))



if __name__ == '__main__':
    if len(sys.argv) != 2:
        print("Usage: vtQuery.py [filehash]")
        exit()
    GetMalwareCNCServFromVTapi(sys.argv[1])