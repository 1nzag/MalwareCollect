import os, sys
import time
import csvutil
import URLhaus
from datetime import datetime

CollectedURLList = []
URLrecentDate = datetime(2000,1,1,1,1)


def URL_Init():
    global CollectedURLList, URLrecentDate
    URLhaus.DownloadDatabase()
    
    with open(".\\URLhausDatabase\\database.csv", "r") as f:
        CollectedURLList, URLrecentDate = csvutil.CsvGetAliveURL(f)
        print("[+] Init recent URL Database: recent date:", URLrecentDate)

    return

def run():
    global CollectedURLList, URLrecentDate

    URL_Init()

    try:
        while True:
            time.sleep(300) #sleep 5 min
            URLhaus.DownloadDatabase()

            with open(".\\URLhausDatabase\\database.csv", "r") as f:
                CollectedURLList, URLrecentDate = csvutil.CsvUpdateURL(f, CollectedURLList, URLrecentDate)
    
    except KeyboardInterrupt:
        print("[!] Interrupt detected:  exit program")
        exit()
    

if __name__ == '__main__':
    run()